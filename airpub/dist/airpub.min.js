!function(e){"use strict";function t(t,n,r,i,a){function o(t){var n={};return e.forEach(t,function(e){n[e]={},n[e].templateUrl=p+"/"+e+".html","404"!==e&&(n[e].controller=e),"layout"===e&&(n[e].views={layout:n.layout,"@layout":n.archive,"@layout.home":n.archive}),["admin","single"].indexOf(e)>-1&&(n[e].resolve=u(e))}),n}function u(e){var t={admin:c,single:d};return{lazyload:["$ocLazyLoad",t[e]]}}function c(e){return e.load("EditorNinja").then(function(){e.load("EditorNinja.upload"),e.load({files:[m+"bower_components/node-uuid/uuid.js"]})})}function d(e){return e.load({files:[m+"bower_components/marked/lib/marked.js",m+"bower_components/highlightjs/highlight.pack.js"]})}function l(t,n,r){var i=e.copy(n);return i.url=t,r&&"object"==typeof r&&(i=e.extend(i,r)),i}function s(e){return{data:{title:e}}}function f(){if(window.wechat){var e={};airpubConfigs.url&&(e.link=airpubConfigs.url),airpubConfigs.description&&(e.desc=airpubConfigs.description),airpubConfigs.name&&(e.title=airpubConfigs.name),window.wechat("friend",e),window.wechat("timeline",e),window.wechat("weibo",e)}}var g=airpubConfigs.theme||"chill",p=(airpubConfigs.themePath||"bower_components")+"/"+g,m=airpubConfigs.staticPath||"",h=o(["archive","single","admin","404","layout"]);n.otherwise("/404"),t.state("layout",l("",h.layout)).state("layout.home",l("/",h.layout)).state("layout.pager",l("/page/:page",h.archive)).state("layout.single",l("/article/:uri",h.single)).state("layout.create",l("/create",h.admin,s("写新文章"))).state("layout.update",l("/article/:uri/update",h.admin,s("更新文章"))).state("layout.404",l("/404",h[404])),i.config({modules:[{name:"EditorNinja",files:[m+"bower_components/ninja/dist/ninja.min.js",m+"bower_components/ninja/dist/ninja.min.css"]},{name:"EditorNinja.upload",files:[m+"bower_components/ninja/dist/ninja.min.js"]}]}),r.hashPrefix(airpubConfigs.hashPrefix||"!"),airpubConfigs.html5Mode&&r.html5Mode(!0),airpubConfigs.upyun&&a.config(airpubConfigs.upyun),f()}e.module("airpub",["upyun","duoshuo","ui.router","ui.bootstrap","oc.lazyLoad","ngSanitize"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$ocLazyLoadProvider","upyunProvider",t])}(window.angular,window.debug),function(e){"use strict";function t(t,n){return function(r){function i(e){return window.hljs.highlightAuto(e).value}function a(e){var t={};return e.forEach(function(e){var n=-1===e.indexOf(":")?"all":e.split(":")[0];t[n]=e.split(":")[1]}),t}function o(t,n){function r(t){var n=t.split(" ");if(1===n.length)return t.substr(1);var r="";return e.forEach(n,function(e){r+=e.substr(1)+" "}),r}var i=t.split(">");if(!i.length)return n;var a="";return e.forEach(i,function(e){var t="."===e.charAt(0)?"class":"id";a+="<div "+t+'="'+r(e)+'">'}),a+=n,e.forEach(i,function(){a+="</div>"}),a}if(!r)return"";if(!marked)throw new Error("Marked.js is required!");var u;arguments.length>1&&(u=a(Array.prototype.slice.call(arguments,1)));var c={},d=new marked.Renderer;return d.code=function(e,t,r){var i=marked.Renderer.prototype.code.call(this,"unsafe-html"===t?n(e):e,t,r);return u&&u.code?o(u.code,i):i},e.forEach(["blockquote","html","heading","list","listitem","paragraph","table","tablerow","tablecell","image"],function(e){d[e]=function(){var t=marked.Renderer.prototype[e].apply(this,arguments);return u&&u[e]?o(u[e],t):u&&u.all?o(u.all,t):t}}),c.renderer=d,window.hljs&&(c.highlight=i),marked.setOptions(c),t.trustAsHtml(marked(r))}}e.module("airpub").filter("marked",["$sce","$sanitize",t])}(window.angular,window.debug),function(){"use strict";function e(){function e(e){if(window.wechat){var n=window.wechat,r={};angular.forEach(["title","link","desc"],function(n){r[n]=e[n]||t[n]}),n("friend",r),n("timeline",r),n("weibo",r)}}var t={title:"Airpub",link:"http://airpub.io",desc:"基于 Angular.js 搭建，多说数据驱动的纯前端写作工具。"};this.wechat=e}angular.module("airpub").service("share",[e])}(),function(e){"use strict";function t(e){return airpubConfigs?void(e.configs=airpubConfigs):console.error(new Error("airpub 缺少必要的配置文件!"))}e.module("airpub").controller("global",["$scope",t])}(window.angular,window.debug),function(e){"use strict";function t(t,n,r){t.title=t.configs.name||"Airpub",t.description=t.configs.description||"just another Airpub blog",r.wechat({title:t.configs.name,link:t.configs.url,desc:t.configs.description}),n.$on("updateMeta",function(n,r){return"string"==typeof r?t.title=r:void e.forEach(r,function(e,n){t[n]=e})})}e.module("airpub").controller("meta",["$scope","$rootScope","share",t])}(window.angular,window.debug),function(e){"use strict";function t(t,n,r,i,a){function o(e,n){var r=0===n.user_id;return e||r?void(t.isVisitor=!0):void(t.user=n)}function u(){t.hiddenSigninSection=!t.hiddenSigninSection}function c(e,n,i){t.alerts.push({msg:e,type:n||"success"});var a=t.alerts.length-1;return r(function(){t.closeAlert(a)},i?1e3*i:3e3),a}function d(e){t.alerts.splice(e,1)}function l(t,n){if(t&&(0===t.indexOf("http")||0===t.indexOf("https"))){var r=n||document.getElementsByTagName("header")[0];r&&e.element(r).css({"background-image":"url("+t+")"})}}t.location=i,t.state=n,t.hiddenSigninSection=!0,t.toggleSigninSection=u,t.alerts=[],t.addAlert=c,t.closeAlert=d,t.updateBackground=l,t.copyrightYear=(new Date).getFullYear(),a.on("ready",o)}function n(){}e.module("airpub").controller("layout",["$scope",n]).controller("base",["$scope","$state","$timeout","$location","duoshuo",t])}(window.angular,window.debug),function(e){"use strict";function t(e,t,n,r){function i(){function r(n,r,i){return t.params.page&&(u=!1),n?e.addAlert("获取信息失败，请重试","danger"):0===r.length?t.go("layout.404"):(e.articles=r||[],e.totalItems=i.cursor.total,void(t.params.page&&(e.currentPage=c)))}function i(){return t.go("layout.404")}var a={};a.page=e.currentPage,a.limit=e.itemsPerPage,a.with_content=1,n.get("threads/list",a,r,i)}function a(){u||t.go("layout.pager",{page:e.currentPage})}function o(e){return e&&!isNaN(parseInt(e))?parseInt(e):!1}if(e.itemsPerPage=10,e.currentPage=o(t.params.page)||1,r.$emit("updateMeta",e.configs.name),!(e.articles&&e.articles.length>0)){if(t.params.page)var u=!0,c=e.currentPage;i(),e.pageChanged=a}}e.module("airpub").controller("archive",["$scope","$state","duoshuo","$rootScope",t])}(window.angular,window.debug),function(e){"use strict";function t(e,t,n,r){function i(i){function o(t,n){return t?e.addAlert("文章内容获取失败，请稍后再试...","danger"):(e.article=n,r.$emit("updateMeta",{title:n.title,description:c(n.content)}),n.meta&&n.meta.background&&e.updateBackground(n.meta.background),void(n.author_id&&a(n)))}function u(){return t.go("layout.404")}function c(e){var t=80;return e?e.length<=t?e:e.substr(0,t)+"...":""}var d={};d.thread_id=i,n.get("threads/details",d,o,u)}function a(t){function r(t,n){t||(e.author=n,e.author.description=n.connected_services.weibo?n.connected_services.weibo.description:null)}var i={};i.user_id=t.author_id,n.get("users/profile",i,r)}return t.params.uri?(e.threadId=t.params.uri,void(e.article||i(t.params.uri))):t.go("layout.404")}e.module("airpub").controller("single",["$scope","$state","duoshuo","$rootScope",t])}(window.angular,window.debug),function(e){"use strict";function t(t,n,r,i,a){function o(){function e(e,i){function a(e,n){return t.isAdmin=!0,e?o(e):void(t.article=n)}function o(){return t.addAlert("文章内容获取失败，请稍后再试...","danger")}if(e||"administrator"!==i.role)return n.go("layout.home");var u="layout.update"===n.current.name&&n.params.uri;if(!u)return void(t.isAdmin=!0);var c={};c.thread_id=n.params.uri,r.get("threads/details",c,a,o)}function i(e){t.addAlert(e.errorMessage,"danger"),n.go("layout.home")}a.$emit("updateMeta",n.current.data.title),r.get("sites/membership",{},e,i)}function u(){function e(e,i){function a(e){e&&console.log(e),n.go("layout.single",{uri:i.thread_id})}if(e)return t.addAlert("发布失败...","danger");t.addAlert("发布成功");var o={};o.thread_id=i.thread_id,o.url=g+m+"/article/"+i.thread_id,r.post("threads/update",o,a),f("afterCreate",i)}function i(){return t.addAlert("发布失败...","danger")}if(!t.isAdmin)return!1;if(!t.article.title)return t.addAlert("至少写个标题咯...","danger");if(!t.article.content)return t.addAlert("至少写点内容咯...","danger");var a={};a.format="markdown",a.title=t.article.title,a.content=t.article.content,a.thread_key=uuid.v1(),a=l(a),f("beforeCreate",a),r.post("threads/create",a,e,i)}function c(e){function i(r,i){return r?t.addAlert("更新失败，请稍后再试...","danger"):(t.addAlert("更新成功!"),f("afterUpdate",i),void n.go("layout.single",{uri:e}))}function a(){return t.addAlert("更新失败，请稍后再试...","danger")}if(!e)return t.createArticle();if(!t.isAdmin)return!1;var o={};o.thread_id=e,o.title=t.article.title,o.content=t.article.content,o.url=g+m+"/article/"+e,o=l(o),f("beforeUpdate",o),r.post("threads/update",o,i,a)}function d(e){function i(r){return r?t.addAlert("删除失败，请稍后再试...","danger"):(f("afterRemove",e),t.addAlert("删除成功!"),void n.go("layout.home"))}function a(){return t.addAlert("删除失败，请稍后再试...","danger")}if(!e)return!1;if(!t.isAdmin)return!1;f("beforeRemove",e);var o={};o.thread_id=e,r.post("threads/remove",o,i,a)}function l(n){return t.article.meta?(e.forEach(t.article.meta,function(e,t){n["meta["+t+"]"]=e}),n):n}function s(e,n){return e&&n&&"function"==typeof n?(t.bindedEvents||(t.bindedEvents={}),t.bindedEvents[e]=n,t.bindedEvents):!1}function f(e,n){return t.bindedEvents&&t.bindedEvents[e]?t.bindedEvents[e](n||t.article,e):void 0}t.isAdmin=!1;var g=t.configs.url||i.host(),p=t.configs.hashPrefix||"!",m="/#"+p;o(),t.createArticle=u,t.updateArticle=c,t.removeArticle=d,t.on=s}e.module("airpub").controller("admin",["$scope","$state","duoshuo","$location","$rootScope",t])}(window.angular,window.debug),function(){"use strict";function e(e){function t(t,n,r,i){function a(){c||(c=!0,e.upload("metaBackgroundForm",function(e,t,n){if(c=!1,e)return console.error(e),alert("上传失败，请稍后再试...");var r=200===n.code&&"ok"===n.message;r&&(o(n.absUrl),i.$setViewValue(n.absUrl))}))}function o(e){if(e&&0===e.indexOf("http")){var t=document.getElementsByTagName("header")[0],n=document.getElementById("metaBackground");if(t){var r={};r["background-image"]="url("+e+")",u(t).css(r),u(n).css(r)}}}var u=angular.element,c=!1,d=document.getElementById("uploadBackgroundBtn");u(d).on("change",a),i.$render=function(){o(i.$viewValue)}}var n={restrict:"AE",require:"ngModel",replace:!0,link:t,template:['<div id="metaBackground" class="meta-background clearfix">','<form name="metaBackgroundForm">','<input type="file" name="file" id="uploadBackgroundBtn" class="pull-left hidden-input"/>','<span class="upload-background-btn fa fa-cloud-upload">',"上传背景图片","</span>","</form>","</div>"].join("\n")};return n}function t(e){function t(e,t,n,r){function i(){r.$setViewValue(e.checkToShare)}function a(e){return function(e){return}}e.checkToShare=!1,e.updateCheckStatus=i,e.on("afterCreate",a()),e.on("afterUpdate",a())}var n={restrict:"AE",require:"ngModel",replace:!0,link:t,template:['<div id="metaShare" class="meta-share clearfix"">','<input type="checkbox" id="checkToShare" ng-model="checkToShare" ng-change="updateCheckStatus()" />','<label for="checkToShare">分享到微博</label>',"</div>"].join("\n")};return n}angular.module("airpub").directive("metaBackground",["upyun",e]).directive("metaShare",["duoshuo",t])}();
//# sourceMappingURL=airpub.min.js.map